<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClickHouse & Flat File Data Ingestion Tool</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <span class="navbar-brand mb-0 h1">ClickHouse & Flat File Data Ingestion Tool</span>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Source Selection -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>Select Data Source</h5>
            </div>
            <div class="card-body">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="sourceType" id="sourceClickHouse" value="clickhouse" checked>
                    <label class="form-check-label" for="sourceClickHouse">ClickHouse</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="sourceType" id="sourceFlatFile" value="flatfile">
                    <label class="form-check-label" for="sourceFlatFile">Flat File</label>
                </div>
            </div>
        </div>

        <!-- Connection Configuration -->
        <div class="row">
            <!-- ClickHouse Source Configuration -->
            <div class="col-md-6" id="clickhouseSourcePanel">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>ClickHouse Source Configuration</h5>
                    </div>
                    <div class="card-body">
                        <form id="clickhouseSourceForm">
                            <div class="mb-3">
                                <label for="chHost" class="form-label">Host</label>
                                <input type="text" class="form-control" id="chHost" placeholder="localhost">
                            </div>
                            <div class="mb-3">
                                <label for="chPort" class="form-label">Port</label>
                                <input type="text" class="form-control" id="chPort" placeholder="9000">
                            </div>
                            <div class="mb-3">
                                <label for="chDatabase" class="form-label">Database</label>
                                <input type="text" class="form-control" id="chDatabase" placeholder="default">
                            </div>
                            <div class="mb-3">
                                <label for="chUser" class="form-label">User</label>
                                <input type="text" class="form-control" id="chUser" placeholder="default">
                            </div>
                            <div class="mb-3">
                                <label for="chJwtToken" class="form-label">JWT Token</label>
                                <textarea class="form-control" id="chJwtToken" rows="3" placeholder="(Optional)"></textarea>
                            </div>
                            <button type="button" id="chConnectBtn" class="btn btn-primary">Connect</button>
                            <div class="mt-3" id="chConnectionStatus"></div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Flat File Source Configuration -->
            <div class="col-md-6" id="flatFileSourcePanel" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Flat File Source Configuration</h5>
                    </div>
                    <div class="card-body">
                        <form id="flatFileSourceForm" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="fileUpload" class="form-label">Upload File</label>
                                <input class="form-control" type="file" id="fileUpload">
                            </div>
                            <div class="mb-3">
                                <label for="fileDelimiter" class="form-label">Delimiter</label>
                                <input type="text" class="form-control" id="fileDelimiter" placeholder="," value=",">
                            </div>
                            <button type="button" id="fileUploadBtn" class="btn btn-primary">Upload</button>
                            <div class="mt-3" id="fileUploadStatus"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Selection -->
        <div class="card mb-4" id="dataSelectionPanel" style="display: none;">
            <div class="card-header">
                <h5>Data Selection</h5>
            </div>
            <div class="card-body">
                <!-- ClickHouse Table Selection -->
                <div id="chTableSelection" style="display: none;">
                    <div class="mb-3">
                        <label for="chTableSelect" class="form-label">Select Table</label>
                        <select class="form-select" id="chTableSelect">
                            <option selected disabled>Choose a table...</option>
                        </select>
                    </div>
                    
                    <!-- Bonus: Multi-Table Join -->
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="enableJoin">
                            <label class="form-check-label" for="enableJoin">
                                Enable JOIN with another table
                            </label>
                        </div>
                    </div>
                    
                    <div id="joinPanel" style="display: none;">
                        <div class="mb-3">
                            <label for="joinTableSelect" class="form-label">Join Table</label>
                            <select class="form-select" id="joinTableSelect">
                                <option selected disabled>Choose a join table...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="joinCondition" class="form-label">Join Condition</label>
                            <input type="text" class="form-control" id="joinCondition" 
                                   placeholder="e.g., table1.id = table2.id">
                        </div>
                    </div>
                    
                    <button type="button" id="loadColumnsBtn" class="btn btn-primary">Load Columns</button>
                </div>

                <!-- Column Selection -->
                <div id="columnSelectionPanel" style="display: none;" class="mt-4">
                    <h6>Select Columns</h6>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="selectAllColumns">
                            <label class="form-check-label" for="selectAllColumns">
                                Select All
                            </label>
                        </div>
                    </div>
                    <div id="columnsContainer" class="row"></div>
                </div>
            </div>
        </div>

        <!-- Target Configuration -->
        <div class="card mb-4" id="targetConfigPanel" style="display: none;">
            <div class="card-header">
                <h5>Target Configuration</h5>
            </div>
            <div class="card-body">
                <!-- ClickHouse Target (for Flat File source) -->
                <div id="clickhouseTargetPanel" style="display: none;">
                    <form id="clickhouseTargetForm">
                        <div class="mb-3">
                            <label for="chTargetHost" class="form-label">Host</label>
                            <input type="text" class="form-control" id="chTargetHost" placeholder="localhost">
                        </div>
                        <div class="mb-3">
                            <label for="chTargetPort" class="form-label">Port</label>
                            <input type="text" class="form-control" id="chTargetPort" placeholder="9000">
                        </div>
                        <div class="mb-3">
                            <label for="chTargetDatabase" class="form-label">Database</label>
                            <input type="text" class="form-control" id="chTargetDatabase" placeholder="default">
                        </div>
                        <div class="mb-3">
                            <label for="chTargetUser" class="form-label">User</label>
                            <input type="text" class="form-control" id="chTargetUser" placeholder="default">
                        </div>
                        <div class="mb-3">
                            <label for="chTargetJwtToken" class="form-label">JWT Token</label>
                            <textarea class="form-control" id="chTargetJwtToken" rows="3" placeholder="(Optional)"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="chTargetTable" class="form-label">Target Table Name</label>
                            <input type="text" class="form-control" id="chTargetTable" placeholder="my_table">
                        </div>
                    </form>
                </div>
                
                <!-- Flat File Target (for ClickHouse source) -->
                <div id="flatFileTargetPanel" style="display: none;">
                    <form id="flatFileTargetForm">
                        <div class="mb-3">
                            <label for="targetFilename" class="form-label">Output Filename</label>
                            <input type="text" class="form-control" id="targetFilename" placeholder="output.csv">
                        </div>
                        <div class="mb-3">
                            <label for="targetDelimiter" class="form-label">Delimiter</label>
                            <input type="text" class="form-control" id="targetDelimiter" placeholder="," value=",">
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-4">
            <button class="btn btn-primary me-md-2" type="button" id="previewDataBtn" style="display: none;">Preview Data</button>
            <button class="btn btn-success" type="button" id="startIngestionBtn" style="display: none;">Start Ingestion</button>
        </div>

        <!-- Data Preview -->
        <div class="card mb-4" id="dataPreviewPanel" style="display: none;">
            <div class="card-header">
                <h5>Data Preview</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped" id="previewTable">
                        <thead id="previewTableHead"></thead>
                        <tbody id="previewTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Status and Results -->
        <div class="card mb-4" id="statusPanel" style="display: none;">
            <div class="card-header">
                <h5>Ingestion Status</h5>
            </div>
            <div class="card-body">
                <div id="statusMessage" class="alert" role="alert"></div>
                <div id="progressContainer" style="display: none;">
                    <div class="progress mb-3">
                        <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                    </div>
                </div>
                <div id="resultMessage"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
